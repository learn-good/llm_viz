<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Decoder-only transformer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }

        #reporting-container {
            font-size: 16px;
            line-height: 1.5;
            font-family: 'Courier New', Courier, monospace;
            padding: 20px;
            width: 400px;
        }

        #main-container {
            display: flex;
            width: 100%;
            height: 800px;
        }

        #svg-container {
            flex: 0 0 1200px;
            z-index: 10;
        }

        #right-container {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .container {
            display: flex;
            justify-content: center;
        }

        #info-container {
            min-height: 350px;
            padding: 15px;
        }

        #info {
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
            line-height: 1.5;

            height: 800px;
            border-radius: 15px;
            /* overflow-y: auto; */
            overflow: hidden;

        }

        #info .katex {
            font-size: 1.2em;
        }

        /*-=-=-=-=-=-=-=-=-=-=-=-=*/
        /* Main SVG CSS           */
        /*-=-=-=-=-=-=-=-=-=-=-=-=*/


        .nav-button {
            cursor: pointer;
        }
    </style>
    <!-- for LaTeX -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js"></script>
    <!-- for anim -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script> -->
    <!-- for plotting data -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>

<body>
    <!--=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
        HTML
     -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-->
    <div id="main-container">
        <div id="svg-container">
            <!-- TODO  -->
            <svg id="svg" width="1200" height="600px"></svg>
        </div>
        <div id="right-container">
            <div id="info-container">
                <div id="info"></div>
            </div>

        </div>
    </div>
    <div id="reporting-container">
        <div id="log-container">
        </div>
    </div>

    <!--=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
        Javascript
     -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-->
    <script>
        const svg = d3.select("#svg");
        const svgWidth = 1200;
        const svgHeight = 600;

        svg.attr("width", svgWidth).attr("height", svgHeight);

        let currentView = 'root';
        let undoNavigationHistory = [];
        let redoNavigationHistory = [];

        const svgContent = {
            'root': [
                { x: 100, y: 100, width: 200, height: 100, text: 'Box1', link: 'box1' },
                { x: 400, y: 100, width: 200, height: 100, text: 'Box2', link: 'box2' }
            ],
            'box1': [
                { x: 100, y: 100, width: 200, height: 100, text: 'Box1a', link: 'box1a' },
                { x: 400, y: 100, width: 200, height: 100, text: 'Box1b', link: 'box1b' }
            ],
            'box2': [
                { x: 100, y: 100, width: 200, height: 100, text: 'Box2a', link: 'box2a' },
                { x: 400, y: 100, width: 200, height: 100, text: 'Box2b', link: 'box2b' }
            ],
            'box1a': [{ x: 250, y: 250, width: 200, height: 100, text: 'Box1a' }],
            'box1b': [{ x: 250, y: 250, width: 200, height: 100, text: 'Box1b' }],
            'box2a': [{ x: 250, y: 250, width: 200, height: 100, text: 'Box2a' }],
            'box2b': [{ x: 250, y: 250, width: 200, height: 100, text: 'Box2b' }]
        };

        // SVG paths for navigation arrows
        const arrowPaths = {
            up: "M5,20 L15,5 L25,20 Z",
            back: "M20,5 L5,15 L20,25 Z",
            forward: "M10,5 L25,15 L10,25 Z"
        };

        function drawNavigation() {
            svg.selectAll('.nav-button').remove();

            // Back button
            drawArrowButton('back-button', 20, 10, arrowPaths.back, navigateBack, undoNavigationHistory.length > 0);

            // Up button
            // drawArrowButton('up-button', 70, 10, arrowPaths.up, navigateUp, undoNavigationHistory.length > 0);

            // Forward button
            drawArrowButton('forward-button', 70, 10, arrowPaths.forward, navigateForward, redoNavigationHistory.length > 0);
        }

        function drawArrowButton(id, x, y, pathD, clickHandler, isEnabled) {
            const group = svg.append('g')
                .attr('class', 'nav-button')
                .attr('id', id)
                .attr('transform', `translate(${x}, ${y})`)
                .style('cursor', isEnabled ? 'pointer' : 'default');

            // Button background
            group.append('rect')
                .attr('width', 40)
                .attr('height', 40)
                .attr('rx', 5)
                .attr('ry', 5)
                .attr('fill', '#f0f0f0')
                .attr('stroke', '#d0d0d0');

            // Arrow
            group.append('path')
                .attr('d', pathD)
                .attr('fill', 'none')
                .attr('stroke', isEnabled ? '#4a4a4a' : '#a0a0a0')
                .attr('stroke-width', 2)
                .attr('stroke-linecap', 'round')
                .attr('stroke-linejoin', 'round')
                .attr('transform', 'translate(5, 5)'); // Center the arrow within the button

            if (isEnabled) {
                group.on('click', clickHandler);

                // Hover effect
                group.on('mouseover', function () {
                    d3.select(this).select('rect').attr('fill', '#e0e0e0');
                    d3.select(this).select('path').attr('stroke', '#2a2a2a');
                });

                group.on('mouseout', function () {
                    d3.select(this).select('rect').attr('fill', '#f0f0f0');
                    d3.select(this).select('path').attr('stroke', '#4a4a4a');
                });
            }
        }


        function drawContent(view) {
            svg.selectAll('.content').remove();

            const content = svgContent[view];
            const group = svg.append('g').attr('class', 'content');

            content.forEach(item => {
                const rect = group.append('rect')
                    .attr('x', item.x)
                    .attr('y', item.y)
                    .attr('width', item.width)
                    .attr('height', item.height)
                    .attr('fill', 'white')
                    .attr('stroke', 'black');

                group.append('text')
                    .attr('x', item.x + item.width / 2)
                    .attr('y', item.y + item.height / 2)
                    .attr('text-anchor', 'middle')
                    .attr('dominant-baseline', 'central')
                    .text(item.text);

                if (item.link) {
                    rect.style('cursor', 'pointer')
                        .on('click', () => navigateTo(item.link));

                    group.append('rect')
                        .attr('x', item.x)
                        .attr('y', item.y)
                        .attr('width', item.width)
                        .attr('height', item.height)
                        .attr('fill', 'transparent')
                        .style('cursor', 'pointer')
                        .on('click', () => navigateTo(item.link));
                }
            });
        }

        function navigateTo(view) {
            undoNavigationHistory.push(currentView);
            redoNavigationHistory = []; // Clear redo history
            currentView = view;
            updateView();
        }

        // function navigateUp() {
        //     if (undoNavigationHistory.length > 0) {
        //         redoNavigationHistory.push(currentView);
        //         currentView = undoNavigationHistory.pop();
        //         updateView();
        //     }
        // }

        function navigateBack() {
            if (undoNavigationHistory.length > 0) {
                redoNavigationHistory.push(currentView);
                currentView = undoNavigationHistory.pop();
                updateView();
            }
        }

        function navigateForward() {
            if (redoNavigationHistory.length > 0) {
                undoNavigationHistory.push(currentView);
                currentView = redoNavigationHistory.pop();
                updateView();
            }
        }

        function updateView() {
            drawNavigation();
            drawContent(currentView);
        }

        // Initialize the view
        updateView();
    </script>
</body>